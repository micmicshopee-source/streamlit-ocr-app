# 發票模組 UI 設計建議

## 一、目前展示方式的問題

| 問題 | 說明 |
|------|------|
| **按組/按單張隱式切換** | 依「是否有搜尋關鍵字」切換：無字→按組、有字→按單張。用戶不易發現，且搜尋框本意是篩選，不應兼做「視圖切換」。 |
| **按組時全是收合 expander** | 每組一個 expander，標題擠在一行（時間·來源·張數·合計），需逐一點開才能看明細，沒有「組摘要一覽」可快速掃描。 |
| **刪除確認與按鈕分離** | 點「刪除此組」後，確認對話出現在頁面頂部；若 expander 已收合，用戶要往上找確認鈕，容易混淆。 |
| **篩選區過長** | 搜尋、日期、狀態、會計科目、類型、金額、操作按鈕全在同一區，視覺層級不清，且「按組」時部分篩選無效卻仍顯示。 |
| **總覽與明細脫鉤** | 上方「本期數據總覽」是「本月」統計，下方「按組」是依上傳批次，兩者沒有直接對應，用戶難以對照。 |

---

## 二、替代展示方式（選項）

### 方案 A：Tab 明確切換「按組 / 按單張」（推薦）

- **Tab 1「按組」**：先顯示「組摘要表」（表格：建立時間、來源、張數、合計、稅額、操作），可點選一組再展開明細或跳轉到該組；未分組單獨一列。
- **Tab 2「按單張」**：現有可編輯表格 + 搜尋與篩選。
- **優點**：視圖切換明確，搜尋框只負責篩選（在按單張時）；按組時可先看摘要再進明細。

### 方案 B：單一視圖 + 左側「組篩選」

- 主區永遠是「單張表格」，左側或上方增加「依組篩選」：下拉或列表選擇「全部 / 組 A / 組 B / 未分組」。
- **優點**：只有一種表格，邏輯簡單。**缺點**：組的「合計、稅額」需另區塊顯示，無法一覽多組摘要。

### 方案 C：儀表板式卡片 + 明細表

- 上方：每組一張「卡片」（時間、來源、張數、合計、稅額），可點卡片展開下方該組明細表。
- **優點**：視覺清楚、一屏可掃多組。**缺點**：組很多時卡片橫向或縱向會很長，需考慮分頁或收合。

### 方案 D：時間軸 / 列表式

- 左側時間軸或列表（依日期/組），右側對應明細。類似信箱「信件列表 + 內容」。
- **優點**：適合「依時間瀏覽」。**缺點**：Streamlit 做左右聯動需較多 session_state，實作成本高。

---

## 三、建議採用的改動（對應方案 A）

1. **新增「視圖」Tab**  
   - 「📦 按組」／「📋 按單張」兩個 Tab，由用戶主動切換，不再依搜尋框有無字切換。

2. **按組 Tab 內**  
   - **第一區**：組摘要表（`st.dataframe` 或表格），欄位：建立時間、來源（OCR/導入）、張數、合計、稅額、操作（刪除此組）。  
   - **第二區**：可選「預設展開第一組」或「點選某組後下方顯示該組明細」；未分組單獨一區塊（標題 + 張數 + 合計 + 明細表）。

3. **按單張 Tab 內**  
   - 維持現有：搜尋、日期/狀態/科目/類型/金額篩選、操作按鈕、可編輯表格。  
   - 搜尋與篩選僅作用於「按單張」視圖。

4. **刪除確認**  
   - 改為「刪除此組」時用 `st.dialog` 彈出確認（或在同一 expander 內顯示確認按鈕），避免置頂、與按鈕分離。

5. **篩選區**  
   - 在「按單張」Tab 顯示完整篩選；在「按組」Tab 可隱藏或收合為「進階篩選（尚未套用於組視圖）」提示，減少干擾。

6. **總覽與組的對應（可選）**  
   - 在組摘要表下方或側邊加一句說明：「本期數據總覽為本月統計，上表為依上傳批次分組」，或未來在總覽卡片旁提供「依組篩選」以對齊。

---

## 四、UI 線框示意（方案 A）

```
[ 本期數據總覽 ]  本月總計 | 預計稅額 | 發票總數 | 缺失件數

[ 篩選與操作 ]
  搜尋框 | 日期區間 | 狀態 | [ 操作: 刪除 | CSV | Excel | PDF ]
  （按單張時：會計科目、類型、金額區顯示；按組時可收合）

[ 發票明細與編輯 ]
  [ Tab: 📦 按組 ]  [ Tab: 📋 按單張 ]

  --- 按組 ---
  | 建立時間       | 來源 | 張數 | 合計   | 稅額  | 操作     |
  | 2026-01-30 10:00 | OCR  | 4    | $850   | $40   | 刪除此組 |
  | 2026-01-30 10:05 | 導入 | 3    | $1800  | $38   | 刪除此組 |
  | 未分組           | -    | 2    | $300   | $0    | -        |

  展開「第一組」或點選後：
  ┌─ 📦 2026-01-30 · OCR · 4 張 · 合計 $850 ─────────────────┐
  │ 本組總計：$850 元　稅額：$40 元                          │
  │ [ 日期 | 發票號碼 | 賣方名稱 | 總計 | 狀態 ] (dataframe)  │
  │ [ 🗑️ 刪除此組 ] → 點擊後彈出 dialog 確認                 │
  └─────────────────────────────────────────────────────────┘

  --- 按單張 ---
  （現有可編輯表格 + 搜尋/篩選）
```

---

## 五、小結

- **展示邏輯**：改為「Tab 切換按組 / 按單張」，不再用搜尋框隱式切換。  
- **按組**：先「組摘要表」一覽，再展開或點選看明細；刪除改為 dialog 或區塊內確認。  
- **按單張**：維持現有表格與篩選，搜尋僅作用於此視圖。  
- **篩選**：按組時可收合或簡化，按單張時完整顯示。

以上可依開發資源分階段實作：先做 Tab + 組摘要表 + 刪除確認改進，再優化篩選區與總覽說明。

---

## 六、已實作項目（本次改版）

- **視圖切換**：改為「📦 按組」／「📋 按單張」單選（radio），不再依搜尋框有無字切換。
- **按組視圖**：先顯示「組摘要表」（建立時間、來源、張數、合計、稅額），再以 expander 展開各組明細與未分組；刪除此組改為 **st.dialog** 確認，避免置頂混淆。
- **按單張視圖**：篩選（搜尋、日期、狀態、會計科目、類型、金額）僅在此視圖套用；操作（刪除 N 條、CSV、Excel、PDF）僅在此視圖顯示。
- **導出全部**：按組視圖提供「📥 CSV（全部）」；Excel／PDF 仍於按單張視圖依當前篩選導出。
