# 產品需求文檔（PRD）— 上班族小工具

**版本**：v2.0  
**更新日期**：2026-01-29  
**適用**：台灣上班族、行政與財務人員  
**產品**：上班族小工具（發票報帳・辦公小幫手）

---

## 一、文件目的與範圍

本需求文檔定義「上班族小工具」產品的功能與非功能需求，重點包含：

- **登入模塊**：嚴謹化需求與多種登入方式（電子郵件密碼、Google、LINE、Facebook、Instagram）。
- **核心功能**：發票報帳小秘笈及後續小工具（AI 合約比對、AI 客服小秘、AI 會議精華等）。
- **介面與體驗**：台灣用語、隱私說明、小工具導航。
- **現有功能優化**：依《台灣上線檢查與規劃》優化現有功能、邏輯、排版與設計（見本章第八節及附錄）。

**參考文件**：`台灣上線檢查與規劃.md`（產品經理檢查報告 + 上線規劃）。

---

## 二、登入模塊需求

### 2.1 登入方式清單

| 登入方式 | 說明 | 優先級 | 狀態 |
|----------|------|--------|------|
| **電子郵件 + 密碼** | 本站註冊，密碼符合強度規則 | P0 | ✅ 已實作 |
| **忘記密碼** | 僅限本站註冊帳號，驗證後重設密碼 | P0 | ✅ 已實作 |
| **Google 登入** | OAuth 2.0，取得 email 作為帳號識別 | P0 | 🔜 待開發 |
| **LINE 登入** | LINE Login (OAuth 2.0)，台灣用戶常用 | P0 | 🔜 待開發 |
| **Facebook 登入** | Facebook Login (OAuth 2.0) | P1 | 🔜 待開發 |
| **Instagram 登入** | 透過 Meta（Facebook Login）或 Instagram Basic Display；詳見開發文檔 | P2 | 🔜 規劃 |

**說明**：Instagram 官方對網頁「純 Instagram 帳號登入」支援有限，多數情境以 **Facebook 登入** 取得 Meta 權限，或使用 **Instagram Basic Display API**（需審核）。需求上保留「Instagram 登入」選項，實作可與 Facebook 登入共用或分階段提供。

### 2.2 登入模塊嚴謹化需求

以下為登入模塊必須滿足之嚴謹性需求，供開發與驗收使用。

#### 2.2.1 身分驗證安全

| 需求 ID | 需求描述 | 驗收標準 |
|---------|----------|----------|
| AUTH-01 | 密碼儲存須使用**安全雜湊**（如 bcrypt、Argon2 或 PBKDF2），禁止明文或僅 SHA256 | 新註冊／重設密碼一律以安全雜湊寫入；舊資料可遷移或於下次重設時升級 |
| AUTH-02 | 密碼強度：至少 8 字元，建議含大小寫、數字、符號其中至少兩類 | 註冊／重設密碼時前端檢核並提示；後端強制檢核 |
| AUTH-03 | 登入失敗達 **N 次**（建議 N=5）後，該帳號或該 IP 暫時鎖定一段時間（如 15 分鐘） | 鎖定期內該帳號／IP 登入一律回傳「帳號暫時鎖定，請稍後再試」 |
| AUTH-04 | 登入成功後建立 **Session**，Session 具過期時間（如 24 小時或 7 天可設定） | 過期後須重新登入；登出時廢止 Session |
| AUTH-05 | 敏感操作（登入、註冊、重設密碼）須防 **CSRF**（如 Token 或 SameSite Cookie） | 表單提交時驗證 CSRF Token 或依框架建議實作 |

#### 2.2.2 帳號與註冊

| 需求 ID | 需求描述 | 驗收標準 |
|---------|----------|----------|
| AUTH-06 | 電子郵件格式檢核（含格式與長度上限） | 前後端皆檢核；錯誤時回傳明確訊息（台灣用語） |
| AUTH-07 | 註冊時若該電子郵件已存在（本站或已綁定第三方），回傳「此電子郵件已註冊」並引導登入或綁定 | 不重複建立同一 email 之多個帳號 |
| AUTH-08 | 第三方登入（Google/LINE/Facebook）首次登入時，可選擇**綁定既有本站帳號**或**建立新帳號** | 流程與文案在需求規格中定義；實作見開發文檔 |

#### 2.2.3 錯誤與稽核

| 需求 ID | 需求描述 | 驗收標準 |
|---------|----------|----------|
| AUTH-09 | 登入失敗時**不透露**「是電子郵件錯誤還是密碼錯誤」 | 統一回傳「電子郵件或密碼錯誤」或「帳號或密碼錯誤」 |
| AUTH-10 | 重要事件可記錄稽核日誌（選配）：登入成功／失敗、重設密碼、綁定第三方 | 日誌含時間、識別（user_id 或 email hash）、結果；不記錄明文密碼 |

### 2.3 登入介面需求（台灣）

- **用語**：登入、註冊、電子郵件、密碼、重設密碼、登出；不使用「登錄」「郵箱」等非台灣慣用語。
- **標題**：例如「上班族小工具」；副標「登入以使用發票報帳與更多辦公小幫手」。
- **隱私說明**：登入頁可見「您的資料僅供您本人使用，我們不會分享給第三方」。
- **按鈕**：依序或分區提供「電子郵件登入」「Google 登入」「LINE 登入」「Facebook 登入」「Instagram 登入」（可依實作狀態標註「即將推出」）。

---

## 三、功能需求（產品功能）

### 3.1 發票報帳小秘笈（已上線）

| 功能 | 描述 | 優先級 |
|------|------|--------|
| 發票 OCR | 上傳發票/收據圖片，以 AI 辨識欄位並寫入 | P0 |
| CSV/Excel 導入 | 批次導入發票資料，支援模板下載 | P0 |
| 發票資料表 | 查詢、篩選、編輯、刪除；進階篩選 | P0 |
| 本期數據總覽 | 本月總計、稅額、發票數、缺失件數 | P0 |
| 導出 CSV/PDF | 僅當前登入用戶資料；PDF 可填公司資訊 | P0 |
| AI 報帳小助理 | 對話式記帳、會計科目與操作諮詢 | P1 |

### 3.2 小工具導航與擴充

| 功能 | 描述 | 優先級 |
|------|------|--------|
| 左側小工具選單 | 發票報帳、AI 合約比對、AI 客服小秘、AI 會議精華等 | P0 |
| AI 合約比對 | 上傳兩份合約/條款，AI 標示差異與重點 | P1 |
| AI 客服小秘 | 代擬回覆、整理客訴、常見問答建議 | P1 |
| AI 會議精華 | 上傳逐字稿或轉寫，產出結論與待辦 | P1 |
| 其他辦公小工具 | 請購單整理、差旅費試算、預算 vs 實際等（見台灣上線檢查與規劃） | P2 |

### 3.3 多用戶與資料隔離

- 所有資料依**當前登入身分**隔離（以 `user_id` 或統一識別碼為準）。
- 用戶僅能查詢、編輯、導出、刪除自己的資料；後端所有查詢必須帶入當前用戶條件。

---

## 四、用戶故事（登入相關）

- **US-A1**：作為用戶，我使用電子郵件與密碼登入，以便使用發票報帳與小工具。
- **US-A2**：作為用戶，我忘記密碼時可透過註冊信箱重設密碼，以便繼續使用同一帳號。
- **US-A3**：作為用戶，我使用 Google 帳號登入，以便免記密碼快速進入。
- **US-A4**：作為用戶，我使用 LINE 帳號登入，以便在台灣常用管道快速進入。
- **US-A5**：作為用戶，我使用 Facebook 帳號登入，以便以社群帳號進入。
- **US-A6**：作為用戶，登入失敗多次後我看到「帳號暫時鎖定」說明，而非無限嘗試。
- **US-A7**：作為用戶，我登出後再次進入須重新登入，以確保他人無法沿用我的 Session。

---

## 五、非功能需求

| 類別 | 需求 |
|------|------|
| **可用性** | 介面文案為繁體中文（台灣用語）；登入流程於 3 步驟內完成（選方式 → 授權/輸入 → 進入）。 |
| **效能** | 登入驗證回應時間建議小於 2 秒（不含第三方 OAuth 跳轉）。 |
| **安全** | 傳輸須為 HTTPS；密碼與 Token 不明文記錄；依 2.2 節落實登入嚴謹化。 |
| **隱私** | 僅蒐集登入與服務所需之最小資料；隱私說明於登入頁可見。 |

---

## 六、需求優先級與依賴

- **P0**：電子郵件密碼登入（含嚴謹化）、忘記密碼、Google 登入、LINE 登入、小工具導航、發票報帳完整流程。
- **P1**：Facebook 登入、登入失敗鎖定、Session 過期、密碼強度與安全雜湊、AI 合約比對／客服小秘／會議精華。
- **P2**：Instagram 登入（或與 Facebook 整合）、稽核日誌、更多辦公小工具。

**依賴**：第三方登入（Google/LINE/Facebook）依賴各平台開發者帳號與 OAuth 設定；實作細節見《開發文檔》。

---

## 七、名詞與參考文件

- **本站帳號**：以本系統註冊之電子郵件+密碼帳號（存於 `users` 表）。
- **第三方登入**：透過 Google / LINE / Facebook / Instagram 授權取得身分，並與本站帳號綁定或建立新帳號。
- **參考**：`台灣上線檢查與規劃.md`、`開發文檔.md`。

---

## 八、現有功能總覽與優化目標（依台灣上線檢查與規劃）

本節將《台灣上線檢查與規劃》納入需求文檔，**重點為優化現有功能**，作為驗收與上線依據。

### 8.1 現有網頁功能總覽

| 功能 | 說明 | 狀態 |
|------|------|------|
| **發票 OCR 辨識** | 上傳發票/收據圖片，以 Gemini AI 辨識欄位（日期、發票號碼、賣方、金額、稅額等） | ✅ 可用 |
| **CSV/Excel 導入** | 批次導入既有發票資料（支援模板下載） | ✅ 可用 |
| **發票資料表** | 查詢、篩選、編輯、刪除單筆；進階篩選（會計科目、類型、金額） | ✅ 可用 |
| **本期數據總覽** | 本月總計、預計稅額、發票總數、缺失件數（四張指標卡） | ✅ 可用 |
| **導出** | 導出 CSV、PDF（含公司資訊、僅當前用戶資料） | ✅ 可用 |
| **AI 報帳小助理** | 對話式報帳：一句話記帳、問會計科目與操作 | ✅ 可用（需 API Key） |

- **登入與權限**：多用戶隔離；每人僅能看見、編輯、導出、刪除自己的資料。
- **邏輯與資料流**：資料來源 SQLite（`invoices_v2.db`），依 `user_email` 隔離；流程為上傳圖片/CSV → AI 辨識或解析 → 寫入 DB → 表格編輯/篩選 → 導出 CSV/PDF；Gemini API Key 可放 Secrets 或側邊欄手動輸入。

### 8.2 功能／邏輯／排版／設計優化對照表

| 項目 | 現狀 | 優化目標（上線前調整） |
|------|------|------------------------|
| **功能** | 發票 OCR、導入、表格、導出、AI 小助理完整 | 左側改為小工具導航；其餘工具先做佔位頁 |
| **邏輯** | 多用戶隔離、DB 寫入、API Key/Secrets | 維持；僅隱藏技術狀態不顯示在側欄 |
| **排版** | 主區三步驟 + 總覽 + 表格；側欄原為系統狀態 | 側欄改為工具選單 + 帳號 + 設定收合 |
| **設計** | Material 3 深色、響應式 | 登入頁改台灣用語與標題；加隱私一句話 |
| **登入** | 信箱/密碼、註冊、忘記密碼、Secrets、環境變數 | 文案改為台灣用語；Google/LINE/FB/IG 標註開發中或已上線 |

### 8.3 左側導航優化（已納入需求）

- **移除**：標題「⚙️ 系統狀態」；資料庫狀態（本地磁碟/記憶體）、已存筆數、嘗試切換文件模式等技術資訊。
- **新側邊欄結構**：
  1. **小工具選單**：📑 發票報帳小秘笈（預設）、⚖️ AI 合約比對、📧 AI 客服小秘、📅 AI 會議精華（其餘可擴充）。
  2. **帳號區**：顯示當前用戶（電子郵件）、登出按鈕。
  3. **設定區**（可收合）：Gemini API Key（或「已使用 Secrets 金鑰」）、辨識模型選單；不再顯示資料庫/筆數。
- 主內容區依「目前選中的小工具」切換；未開發的工具顯示「即將推出」或「開發中」說明頁。

### 8.4 台灣登入介面優化要點

- **標題**：「上班族小工具」或「發票報帳・辦公小幫手」；副標「登入以使用發票報帳與更多工具」。
- **用語**：登入、註冊、電子郵件、密碼、重設密碼、登出（台灣慣用）。
- **版面**：置中卡片式；登入頁可見「您的資料僅供您本人使用，我們不會分享給第三方」。
- **選項**：登入 / 註冊 並列；忘記密碼；Google / LINE / Facebook / Instagram 登入（依實作狀態標註）。

### 8.5 建議的台灣辦公／行政／財務小工具（擴充清單）

| 圖示 | 工具名稱 | 說明 |
|------|----------|------|
| 📑 | 發票報帳小秘笈 | 現有：OCR、導入、報表、AI 小助理 |
| ⚖️ | AI 合約比對 | 上傳兩份合約/條款，AI 標示差異與重點 |
| 📧 | AI 客服小秘 | 代擬回覆、整理客訴重點、常見問答建議 |
| 📅 | AI 會議精華 | 上傳逐字稿或錄音轉文字，產出結論與待辦 |
| 📋 | 請購／報價單整理 | 多張請購單或報價單欄位辨識、彙整成表 |
| 🧾 | 差旅費試算 | 輸入機票、住宿、每日餐費等，依公司規則試算與分類 |
| 📊 | 預算 vs 實際 | 上傳預算表與實際支出，AI 協助對比與標註差異 |
| 🗂️ | 檔案命名小幫手 | 依內容或規則建議統一檔名（如：日期_案名_版本） |
| 📎 | 收發文登記 | 簡單的收文/發文登錄與查詢（可接 AI 摘要） |
| 💰 | 零用金／代墊結算 | 登錄代墊項目與金額，產出結算表供報帳 |

以上可依資源分階段上線；優先保留「發票報帳」「AI 合約比對」「AI 客服小秘」「AI 會議精華」四個入口，其餘列在導航為「即將推出」或第二波清單。

### 8.6 上線前檢查清單（現有功能優化）

- [ ] 登入頁：標題與全部文案改為台灣用語。
- [ ] 側邊欄：移除「系統狀態」及資料庫/筆數顯示；改為小工具選單 + 帳號 + API Key/模型收合。
- [ ] 主內容：依所選工具切換（發票報帳 = 現有頁面；其餘 = 開發中說明）。
- [ ] 登入方式：產品說明/說明頁列出「電子郵件+密碼、忘記密碼、Secrets、環境變數」，並註明 Google/LINE/Facebook/Instagram 登入規劃或已上線。
- [ ] 新工具：至少保留「發票」「合約比對」「客服小秘」「會議精華」四個入口，其餘可列在「更多小工具（規劃中）」。
