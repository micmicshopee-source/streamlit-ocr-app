# 上線準備清單

**準備日期**: 2026-01-26  
**應用版本**: app.py (生產版本)  
**狀態**: ✅ 已清理測試內容，準備上線

---

## ✅ 已完成的清理工作

### 1. 測試帳號清理 ✅
- [x] 移除默認測試帳號（admin@example.com, test@example.com）
- [x] 移除測試帳號提示信息
- [x] 移除登錄頁面的測試帳號說明

### 2. 調試功能清理 ✅
- [x] 移除調試模式開關（`debug_mode` checkbox）
- [x] 移除所有調試信息輸出
- [x] 移除調試相關的條件判斷

### 3. 測試模式清理 ✅
- [x] 移除內存模式（測試用）選項
- [x] 強制使用數據庫模式（生產環境）
- [x] 保留內存模式作為自動降級方案（僅在數據庫失敗時使用）

### 4. 測試數據清理 ✅
- [x] 移除 CSV 導入模板中的測試數據
- [x] 將測試數據改為範例數據
- [x] 移除數據庫清理按鈕（避免誤操作）

### 5. 測試提示清理 ✅
- [x] 移除所有"測試用"相關提示
- [x] 移除"內存模式"相關提示
- [x] 清理測試相關的幫助信息

---

## 📋 上線前檢查清單

### 安全性檢查
- [x] ✅ 移除所有測試帳號
- [x] ✅ 移除默認密碼
- [x] ✅ 確保所有用戶必須註冊
- [x] ✅ 驗證 SQL 注入防護（已修復 Bug #1）
- [x] ✅ 確認密碼使用哈希存儲
- [x] ✅ 確認 API Key 使用 Secrets 或密碼輸入

### 功能完整性
- [x] ✅ 用戶註冊功能正常
- [x] ✅ 用戶登錄功能正常
- [x] ✅ 多用戶數據隔離正常
- [x] ✅ OCR 識別功能正常
- [x] ✅ 數據導入/導出功能正常
- [x] ✅ 數據編輯功能正常
- [x] ✅ 數據刪除功能正常（含確認對話框）
- [x] ✅ 圖表顯示功能正常
- [x] ✅ 統計功能正常

### 數據庫配置
- [x] ✅ 使用生產數據庫（invoices_v2.db）
- [x] ✅ 數據庫自動初始化
- [x] ✅ 多用戶隔離正常
- [x] ✅ 數據持久化正常

### 錯誤處理
- [x] ✅ 刪除確認對話框（已修復 Bug #2）
- [x] ✅ 篩選後刪除功能正常（已修復 Bug #3）
- [x] ✅ 錯誤信息完整顯示（已修復 Bug #4）
- [x] ✅ OCR 重試機制（已修復 Bug #5）

### 性能優化
- [x] ✅ OCR 請求重試機制
- [x] ✅ 圖片自動優化（縮放、格式轉換）
- [x] ✅ 數據庫查詢優化

---

## 🔧 上線前配置

### 1. 環境變數配置

#### Streamlit Secrets 配置（推薦）
在 `.streamlit/secrets.toml` 中配置：

```toml
GEMINI_API_KEY = "your-api-key-here"

# 可選：預配置用戶（生產環境建議移除，使用註冊功能）
# USERS = {
#     "admin@company.com": "secure-password"
# }
```

#### 環境變數配置（備選）
```bash
export GEMINI_API_KEY="your-api-key-here"
```

### 2. 數據庫初始化
- 應用首次運行會自動創建數據庫
- 數據庫文件：`invoices_v2.db`
- 自動創建表結構（users, invoices）

### 3. 圖片存儲目錄
- 自動創建：`invoice_images/`
- 按用戶郵箱分目錄存儲
- 自動生成唯一文件名

### 4. 依賴安裝
確保安裝所有依賴：
```bash
pip install -r requirements.txt
```

**必需依賴**:
- streamlit
- google-generativeai
- Pillow
- pandas
- altair
- requests
- sqlite3 (內置)
- fpdf2 (可選，用於 PDF 導出)

---

## 🚀 部署步驟

### 1. 本地部署

#### 步驟 1: 準備環境
```bash
# 進入項目目錄
cd d:\streamlit_ocr_app

# 安裝依賴
pip install -r requirements.txt
```

#### 步驟 2: 配置 Secrets（可選）
創建 `.streamlit/secrets.toml`:
```toml
GEMINI_API_KEY = "your-api-key"
```

#### 步驟 3: 啟動應用
```bash
streamlit run app.py
```

### 2. Streamlit Cloud 部署

#### 步驟 1: 準備 GitHub 倉庫
- 上傳代碼到 GitHub
- 確保 `.gitignore` 包含敏感文件

#### 步驟 2: 在 Streamlit Cloud 配置
1. 連接 GitHub 倉庫
2. 設置 Secrets：
   - `GEMINI_API_KEY`: 您的 API Key
3. 設置主文件：`app.py`
4. 部署

### 3. 其他雲平台部署

#### Docker 部署（示例）
```dockerfile
FROM python:3.9-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 8501

CMD ["streamlit", "run", "app.py", "--server.port=8501", "--server.address=0.0.0.0"]
```

---

## 📝 上線後維護

### 1. 監控項目
- [ ] 監控 API 使用量（Gemini API）
- [ ] 監控數據庫大小
- [ ] 監控用戶註冊數量
- [ ] 監控錯誤日誌

### 2. 備份策略
- [ ] 定期備份數據庫文件（invoices_v2.db）
- [ ] 備份圖片目錄（invoice_images/）
- [ ] 設置自動備份計劃

### 3. 安全建議
- [ ] 定期更新依賴包
- [ ] 監控異常登錄行為
- [ ] 定期審查用戶數據
- [ ] 考慮添加會話超時機制

### 4. 性能優化
- [ ] 監控數據庫查詢性能
- [ ] 考慮添加數據分頁（如果數據量大）
- [ ] 優化圖片存儲策略
- [ ] 考慮添加緩存機制

---

## ⚠️ 已知限制

### 功能限制
1. **數據量限制**: 如果數據量很大（>1000條），表格渲染可能較慢
2. **圖片大小**: 建議單張圖片不超過 10MB
3. **批量上傳**: 建議每次不超過 20 張圖片

### 技術限制
1. **單機部署**: 當前為單機版本，不支持集群部署
2. **會話管理**: 使用 Streamlit session_state，刷新頁面會清除會話
3. **數據庫**: 使用 SQLite，不適合高並發場景

---

## 📊 上線檢查表

### 代碼檢查
- [x] ✅ 無測試帳號
- [x] ✅ 無調試代碼
- [x] ✅ 無測試模式選項
- [x] ✅ 無測試數據
- [x] ✅ 無語法錯誤
- [x] ✅ 無 Linter 錯誤

### 功能檢查
- [x] ✅ 註冊功能正常
- [x] ✅ 登錄功能正常
- [x] ✅ OCR 識別正常
- [x] ✅ 數據導入/導出正常
- [x] ✅ 數據編輯正常
- [x] ✅ 數據刪除正常
- [x] ✅ 圖表顯示正常

### 安全檢查
- [x] ✅ 密碼哈希存儲
- [x] ✅ SQL 注入防護
- [x] ✅ 多用戶數據隔離
- [x] ✅ API Key 安全存儲

### 性能檢查
- [x] ✅ OCR 重試機制
- [x] ✅ 圖片自動優化
- [x] ✅ 數據庫查詢優化

---

## 🎯 上線後建議

### 短期（1-2週）
1. 監控用戶註冊和使用情況
2. 收集用戶反饋
3. 修復發現的問題
4. 優化性能瓶頸

### 中期（1-3個月）
1. 實施剩餘的 P2 級別 Bug 修復
2. 添加數據備份功能
3. 優化用戶體驗
4. 考慮添加新功能

### 長期（3-6個月）
1. 考慮遷移到更強大的數據庫（如 PostgreSQL）
2. 實施集群部署
3. 添加更多分析功能
4. 考慮移動端適配

---

## 📞 支持與維護

### 問題報告
如發現問題，請記錄：
1. 問題描述
2. 復現步驟
3. 錯誤信息
4. 環境信息

### 更新日誌
建議維護更新日誌，記錄：
- 功能更新
- Bug 修復
- 性能優化
- 安全更新

---

## ✅ 上線確認

**準備狀態**: ✅ **已準備就緒，可以上線**

**確認項目**:
- [x] 所有測試內容已清理
- [x] 所有關鍵 Bug 已修復
- [x] 安全性檢查通過
- [x] 功能完整性檢查通過
- [x] 代碼質量檢查通過

**建議**:
1. 在測試環境進行最後一次完整測試
2. 準備回滾方案
3. 通知相關用戶
4. 監控上線後的前 24 小時

---

**文檔版本**: v1.0  
**創建日期**: 2026-01-26  
**狀態**: ✅ 準備上線
