# 發票模組篩選與展示優化報告

**日期**：2026-01-29  
**範圍**：發票收據報帳小秘笈 — 篩選條件、無數據提示、時間範圍、表格展示、流程區塊

---

## 一、現狀與問題

### 1.1 篩選條件被折疊

- **現狀**：「進階篩選（會計科目、類型、金額）」放在 `st.expander(..., expanded=False)` 中，預設收合。
- **問題**：使用者需多點一步才能使用會計科目、類型、金額篩選，不利於常用情境。
- **建議**：改為不折疊 — 將進階篩選改為 `expanded=True`，或移出 expander，改為常駐區塊（與搜尋、時間範圍、狀態同一區塊或緊接下方）。

### 1.2 「調試信息：為什麼沒有顯示數據？」顯得像測試

- **現狀**：篩選後結果為 0 筆時，顯示 expander「🔍 調試信息：為什麼沒有顯示數據？」，內容含：
  - 原始數據行數、篩選後數據行數
  - 當前篩選條件（關鍵字、日期範圍、時間篩選）
  - **原始數據前 3 行（用於調試）**
  - 提示與「清除所有篩選條件」按鈕
- **問題**：標題與「原始數據前 3 行」明顯為開發調試用，對一般使用者不友善；自訂日期以兩個 `date_input` 並排，佔空間且視覺較碎。
- **建議**：
  - 標題改為使用者導向，例如：「目前篩選結果為 0 筆」或「沒有符合條件的發票」。
  - 內文保留：簡要列出「目前篩選條件」與「清除篩選」按鈕；**移除「原始數據前 3 行」**，不再顯示原始資料表。
  - 自訂時間：可改為單一「日期範圍」選擇（例如一個欄位選「自訂」後出現「開始日期」「結束日期」同一行、或改用 `st.date_input` 的 range 若框架支援），避免版面零散。

### 1.3 時間範圍的其它表現方式

- **現狀**：`selectbox` 選「全部 / 本日 / 本週 / 自訂日期」；選「自訂日期」時下方出現兩格 `date_input`（開始、結束）。
- **問題**：自訂日期展示較占位、視覺不集中；僅四種選項，缺少「本月」「最近 30 天」等常見需求。
- **建議**：
  - **選項擴充**：改為「全部」「本日」「本週」「本月」「最近 30 天」「自訂區間」等，依需求取捨。
  - **表現方式**：可改為 **pills**（與狀態篩選一致）或 **radio**，讓時間範圍與狀態篩選風格統一；「自訂區間」選中後再於同一行或下一行顯示開始／結束日期，保持簡潔。

### 1.4 表格展示方式

- **現狀**：發票明細使用可編輯表格（`st.data_editor`），欄位多時需橫向捲動，版面較擠。
- **問題**：使用者反映「這種表格不好看」— 可能指欄寬、字體、對齊或整體視覺。
- **建議**（可擇一或分階段）：
  - **A. 優化現有表格**：固定重要欄位（日期、發票號碼、賣方、總計）欄寬、金額右對齊、標題列樣式（與主題一致），必要時隱藏次要欄位於「展開詳情」。
  - **B. 卡片式列表**：每筆發票一卡片（日期、發票號、賣方、金額、狀態），點擊展開詳情／編輯；適合筆數不多、行動裝置。
  - **C. 分頁表格**：維持表格，但加分頁或「每頁筆數」選擇，減少單頁過長與捲動。
  - **D. 雙模式**：提供「表格檢視」與「列表檢視」切換，滿足不同習慣。

### 1.5 本期數據總覽上方的流程區塊

- **現狀**：「本期數據總覽」上方有「步驟導引（1→2→3）」：上傳 → 辨識／校正 → 導出，以三欄並排顯示。
- **問題**：使用者回饋「沒用」— 實際操作已在同一頁完成（上傳按鈕、表格、導出按鈕），步驟區塊重複且佔空間。
- **建議**：**移除**本期數據總覽上方的「步驟導引（1→2→3）」區塊，保留標題區的「上傳發票圖／CSV 導入／AI 報帳小助理」按鈕即可；若仍需流程說明，可改為一句 caption 或收合於「使用說明」中。

---

## 二、建議實作優先順序

| 優先 | 項目 | 說明 |
|------|------|------|
| P0 | 移除本期數據總覽上方流程區塊 | 直接刪除 1→2→3 步驟 HTML 與分隔線 |
| P0 | 篩選條件不折疊 | 進階篩選改為 `expanded=True` 或移出 expander |
| P0 | 替換「調試信息」為使用者文案 | 標題改為「目前篩選結果為 0 筆」；移除原始數據前 3 行；保留篩選條件說明與清除按鈕 |
| P1 | 時間範圍表現調整 | 增加「本月」「最近 30 天」；自訂改為同一行或更簡潔；可改為 pills/radio |
| P2 | 表格展示優化 | 先做欄寬／對齊／標題樣式；若有需求再評估卡片或雙模式 |

---

## 三、小結

- **篩選**：進階篩選改為常駐顯示（不折疊）。
- **無數據提示**：不用「調試信息」，改為「目前篩選結果為 0 筆」+ 當前條件 + 清除篩選，不顯示原始資料表。
- **時間範圍**：擴充選項、自訂區間展示簡潔化，可與狀態篩選風格統一（pills/radio）。
- **表格**：先優化現有表格可讀性，再視需求考慮卡片或雙模式。
- **流程區塊**：移除本期數據總覽上方的 1→2→3 步驟區塊。

以上為發票模組篩選與展示優化報告；實作將依 P0 → P1 順序進行。
